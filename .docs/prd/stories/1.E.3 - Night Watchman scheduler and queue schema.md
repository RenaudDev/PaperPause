# 1.E.3 — Night Watchman Scheduler and Queue Schema

Epic: `1 - PaperPause Autonomy System`  
**Status:** ✅ Complete

## Goal
Implement the scheduling "brain" that reads generation manifests and builds a randomized distribution queue.

## Scope
- [x] Implement `scripts/morning-routine/tasks/midnight-scheduler.ts`
- [x] **Success-Gated Mode (`--from-manifests`):**
  - Read manifests from `scripts/morning-routine/.runs/`
  - Only schedule collections where `created.length > 0`
  - Prevents duplicate posts from failed generations
- [x] **Legacy Mode (no flag):**
  - Scan `content/animals/*`
  - **Growth Rule:** posts < 75 → Schedule Daily
  - **Maintenance Rule:** posts ≥ 75 → Schedule Weekly (hash-based)
- [x] **Randomized Time Slots:**
  - Window: 06:00–21:00 UTC (1 AM – 4 PM ET)
  - 15-minute slots, Fisher-Yates shuffled
  - Each collection gets a unique slot
- [x] **JIT Naming:** Generate `board_name` (e.g., `sharks` → "Sharks Coloring Pages")
- [x] **State Management:** Write to `config/distribution-queue.json`

## Queue Schema

```json
{
  "generated_at": "2025-12-26T05:15:00Z",
  "queue": [
    {
      "collection": "dogs",
      "board_name": "Dogs Coloring Pages",
      "mode": "growth",
      "priority": 10,
      "rss_url": "https://paperpause.app/animals/dogs/index.xml",
      "scheduled_at": "2025-12-26T14:30:00Z"
    }
  ]
}
```

## Acceptance Criteria

- [x] Scheduler correctly identifies growth vs maintenance collections
- [x] `--from-manifests` mode only schedules successful generations
- [x] Queue contains `scheduled_at` ISO timestamps for each item
- [x] Time slots are randomized and collision-free
- [x] Board names are title-cased with " Coloring Pages" suffix

## Rollback
Revert to previous version of `midnight-scheduler.ts` (no `--from-manifests` flag, no `scheduled_at` field).
