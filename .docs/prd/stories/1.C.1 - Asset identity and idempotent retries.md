# 1.C.1 — Asset identity + idempotent retries

Epic: `1 - PaperPause Autonomy System`

## Goal
Make the pipeline retry-safe: reruns do not create duplicate uploads or duplicate markdown files.

## Core decision
Introduce a stable **AssetID** and treat all writes as **upserts**.

## AssetID Format (v2)

```
YYYYMMDD-{type-slug}-{setting-slug}-{audience}-{hash4}
```

**Example**: `20251222-yorkshire-terrier-garden-flowers-for-kids-7a3b`

- **type-slug**: Extracted from variant prompt (subject type, e.g., "yorkshire-terrier")
- **setting-slug**: Extracted from variant prompt (setting keywords, e.g., "garden-flowers")
- **audience**: `for-kids` or `for-adults` based on style target audience
- **hash4**: 4-character unique hash (timestamp + random) for collision safety

This format provides SEO keyword richness for R2/Pinterest filenames while preventing collisions across multiple runs on the same day.

## Requirements
- AssetID is unique per generated output (collision-safe via hash).
- A manifest/ledger exists that records the mapping from AssetID → final outputs (md path, r2 keys, etc.).
- Deduplication applies to:
  - Issue #4 logs (don't log the same failure twice for same AssetID/run_id)
  - content markdown (don't generate duplicates)
  - storage uploads (same key overwrite/no-op policy)

## Acceptance criteria
- Re-running the same run does not create extra markdown files.
- Re-running does not create extra PDFs/PNGs with new keys for the same AssetID.
- The system can detect "already finished" and skip work.
- Filenames contain SEO-rich keywords from the variant prompt.
