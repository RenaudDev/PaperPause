{{- /*
  Visual Index Tile: Dense 1:1 Square with Text Overlay
  Usage: {{ partial "visual-index-tile.html" . }}
*/ -}}

{{- $section := . -}}
{{- $allPages := $section.RegularPagesRecursive -}}
{{- $tileImage := "" -}}

{{- /* Logic to determine background image */ -}}
{{- if $section.Params.image_url -}}
  {{- $tileImage = $section.Params.image_url -}}
{{- else if gt (len $allPages) 0 -}}
  {{- $firstPage := index $allPages 0 -}}
  {{- if $firstPage.Params.image_url -}}
    {{- $tileImage = $firstPage.Params.image_url -}}
  {{- end -}}
{{- end -}}

<a href="{{ $section.RelPermalink }}" class="group relative aspect-square bg-slate-100 rounded-2xl overflow-hidden shadow-sm hover:shadow-xl transition-all duration-500 border border-slate-100">
    {{- if $tileImage -}}
    <img src="{{ $tileImage }}" alt="{{ $section.Title }}" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" loading="lazy">
    {{- else -}}
    <div class="w-full h-full bg-teal-50 flex items-center justify-center">
        <span class="text-teal-200">
            <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
        </span>
    </div>
    {{- end -}}
    
    <!-- Text Overlay -->
    <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent opacity-80 group-hover:opacity-90 transition-opacity"></div>
    <div class="absolute inset-0 flex flex-col justify-end p-4 md:p-6">
        <h3 class="font-heading text-base md:text-xl font-bold text-white mb-1 drop-shadow-md leading-tight">
            {{ $section.Title }}
        </h3>
        <p class="text-white/80 text-[10px] md:text-xs font-semibold uppercase tracking-wider">
            {{ len $allPages }} {{ if eq (len $allPages) 1 }}Page{{ else }}Pages{{ end }}
        </p>
    </div>
    
    <!-- Hover Border Accent -->
    <div class="absolute inset-0 border-4 border-teal-500/0 group-hover:border-teal-500/10 transition-all rounded-2xl"></div>
</a>
